var jLinq,jlinq,jl;(function(){var n={command:{query:0,select:1,action:2},exp:{get_path:/\./g,escape_regex:/[\-\[\]\{\}\(\)\*\+\?\.\,\\\^\$\|\#\s]/g},type:{nothing:-1,undefined:0,string:1,number:2,array:3,regex:4,bool:5,method:6,datetime:7,object:99},library:{commands:{},types:{},addType:function(t,i){n.library.types[t]=i},extend:function(t){n.util.isType(n.type.array,t)||(t=[t]),n.util.each(t,function(t){n.library.commands[t.name]=t})},query:function(t,i){if(!n.util.isType(n.type.array,t))throw"jLinq can only query arrays of objects.";t=i.clone||i.clone==null&&jLinq.alwaysClone?n.util.clone(t):t;var r={instance:{ignoreCase:jLinq.ignoreCase,not:!1,lastCommand:null,lastField:null,records:t,removed:[],or:function(){r.startNewCommandSet()},query:{}},canRepeatCommand:function(t){return r.instance.lastCommand!=null&&t.length==r.instance.lastCommand.method.length+1&&n.util.isType(n.type.string,t[0])},commands:[[]],execute:function(){var t=[],i=r.instance;n.util.each(r.instance.records,function(n){i.record=n,r.evaluate(i)?t.push(n):r.instance.removed.push(n)}),r.instance.records=t},findValue:n.util.findValue,evaluate:function(n){for(var u,t=0,i=r.commands.length;t<i;t++)if(u=r.commands[t],r.evaluateSet(u,n))return!0;return!1},evaluateSet:function(t,i){var e,u,f;for(e in t)if(t.hasOwnProperty(e)){u=t[e],i.value=r.findValue(i.record,u.path),i.compare=function(t){return n.util.compare(i.value,t,i)},i.when=function(t){return n.util.when(i.value,t,i)};try{if(f=u.method.apply(i,u.args),u.not&&(f=!f),!f)return!1}catch(o){return!1}}return!0},repeat:function(t){r.instance.lastCommand&&t!=null&&(t=n.util.toArray(t),r.canRepeatCommand(t)&&(r.instance.lastField=t[0],t=n.util.select(t,null,1,null)),r.queue(r.instance.lastCommand,t))},queue:function(t,i){r.instance.lastCommand=t;var u={name:t.name,method:t.method,field:r.instance.lastField,count:t.method.length,args:i,not:r.not};u.args.length>t.method.length&&(u.field=u.args[0],u.args=n.util.remaining(u.args,1),r.instance.lastField=u.field),u.path=u.field,r.commands[r.commands.length-1].push(u),r.not=!1},startNewCommandSet:function(){r.commands.push([])},setNot:function(){r.not=!r.not}};return n.util.each(n.library.commands,function(t){var i,u;t.type==n.command.query?(i=function(){return r.queue(t,arguments),r.instance.query},r.instance.query[t.name]=i,u=n.util.operatorName(t.name),r.instance.query["or"+u]=function(){return r.startNewCommandSet(),i.apply(null,arguments)},r.instance.query["orNot"+u]=function(){return r.startNewCommandSet(),r.setNot(),i.apply(null,arguments)},r.instance.query["and"+u]=function(){return i.apply(null,arguments)},r.instance.query["andNot"+u]=function(){return r.setNot(),i.apply(null,arguments)},r.instance.query["not"+u]=function(){return r.setNot(),i.apply(null,arguments)}):t.type==n.command.select?r.instance.query[t.name]=function(){r.execute();var i=r.instance;return i.compare=function(t,r){return n.util.compare(t,r,i)},i.when=function(t,r){return n.util.when(t,r,i)},t.method.apply(i,arguments)}:t.type==n.command.action&&(r.instance.query[t.name]=function(){var i=r.instance;return i.compare=function(t,r){return n.util.compare(t,r,i)},i.when=function(t,r){return n.util.when(t,r,i)},t.method.apply(i,arguments),r.instance.query})}),r.instance.query.or=function(){return r.startNewCommandSet(),r.repeat(arguments),r.instance.query},r.instance.query.and=function(){return r.repeat(arguments),r.instance.query},r.instance.query.not=function(){return r.setNot(),r.repeat(arguments),r.instance.query},r.instance.query.andNot=function(){return r.setNot(),r.repeat(arguments),r.instance.query},r.instance.query.orNot=function(){return r.startNewCommandSet(),r.setNot(),r.repeat(arguments),r.instance.query},r.instance.query}},util:{trim:function(n){return n=n==null?"":n,n=n.toString(),n.replace(/^\s*|\s*$/g,"")},cloneArray:function(t){var i=[];return n.util.each(t,function(t){i.push(n.util.clone(t))}),i},clone:function(t){var r,i;if(n.util.isType(n.type.array,t))return n.util.cloneArray(t);if(n.util.isType(n.type.object,t)){r={};for(i in t)t.hasOwnProperty(i)&&(r[i]=n.util.clone(t[i]));return r}return t},invoke:function(t,i){var r,u,f;i=i.concat(),r=i[0],u=n.util.findValue(t,r),i=n.util.select(i,null,1,null),r=r.replace(/\..*$/,""),f=n.util.findValue(t,r),t=f===u?t:f;try{return u.apply(t,i)}catch(e){return null}},getPath:function(t){return n.util.toString(t).split(n.exp.get_path)},findValue:function(t,i){if(n.util.isType(n.type.array,i))return n.util.invoke(t,i);if(n.util.isType(n.type.string,i)){i=n.util.getPath(i);for(var r=0;t!=null&&r<i.length;)t=t[i[r++]];return t}return t},elementAt:function(n,t){return n&&n.length>0&&t<n.length&&t>=0?n[t]:null},regexEscape:function(t){return(t?t:"").toString().replace(n.exp.escape_regex,"\\$&")},regexMatch:function(t,i,r){return n.util.isType(n.type.regex,t)&&(t=t.source),t=new RegExp(n.util.toString(t),r?"gi":"g"),n.util.toString(i).match(t)!=null},operatorName:function(n){return n.replace(/^\w/,function(n){return n.toUpperCase()})},compare:function(t,i,r){var u=n.util.when(t,i,r);return u==!0?u:!1},when:function(t,i,r){var e=n.util.getType(t),u,f;for(u in i)if(i.hasOwnProperty(u)&&(f=n.type[u],f==e))return i[u].apply(r,[t]);return i.other?i.other.apply(r,[t]):null},each:function(n,t){var r=0,i;for(i in n)n.hasOwnProperty(i)&&t(n[i],r++)},grab:function(t,i){var r=[];return n.util.each(t,function(n){r.push(i(n))}),r},until:function(n,t){for(var u,i=0,r=n.length;i<r;i++)if(u=t(n[i],i+1),u===!0)return!0;return!1},isType:function(t,i){return n.util.getType(i)==t},getType:function(t){if(t==null)return n.type.nothing;for(var i in n.library.types)if(n.library.types[i](t))return i;return n.type.object},remaining:function(n,t){for(var i=[];t<n.length;t++)i.push(n[t]);return i},apply:function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n},reorder:function(t,i,r){return n.util._performSort(t,i,r)},_performSort:function(t,i,r){var u=i.splice(0,1),h,e,c;if(u.length==0)return t;u=u[0];var s=n.util.isType(n.type.array,u),f=s?u[0]:u,o=f.match(/^\-/);return f=o?f.substr(1):f,o&&(s?u[0]=f:u=f),h=function(t,i){var f=n.util.findValue(t,u),e=n.util.findValue(i,u),s;return f==null&&e==null?(f=0,e=0):f==null&&e!=null?(f=0,e=1):f!=null&&e==null?(f=1,e=0):r&&n.util.isType(n.type.string,f)&&n.util.isType(n.type.string,e)?(f=f.toLowerCase(),e=e.toLowerCase()):f.length&&e.length&&(f=f.length,e=e.length),s=f<e?-1:f>e?1:0,o?-s:s},t.sort(h),i.length>0&&(e=[],c=n.util.group(t,u,r),n.util.each(c,function(t){var u=i.slice(),f=n.util._performSort(t,u,r);e=e.concat(f)}),t=e),t},group:function(t,i,r){for(var f={},o,u,e=0,s=t.length;e<s;e++)o=t[e],u=n.util.toString(n.util.findValue(o,i)),u=r?u.toUpperCase():u,f[u]?f[u].push(o):f[u]=[o];return f},equals:function(t,i,r){return n.util.when(t,{string:function(){return n.util.regexMatch("^"+n.util.regexEscape(i)+"$",t,r)},other:function(){return t==null&&i==null||t===i}})},toArray:function(n){var i=[],t,r;if(n.length)for(t=0;t<n.length;t++)i.push(n[t]);else for(r in n)n.hasOwnProperty(r)&&i.push(n[r]);return i},toString:function(n){return n==null?"":n.toString()},skipTake:function(t,i,r,u){return(r=r==null?0:r,u=u==null?t.length:u,r>=t.length||u==0)?[]:n.util.select(t,i,r,r+u)},select:function(n,t,i,r){var u,e,f,o;if(i=i==null?0:i,r=r==null?n.length:r,u=n.slice(i,r),jLinq.util.isType(jLinq.type.object,t)&&(e=t,t=function(n){var i={},t;for(t in e)e.hasOwnProperty(t)&&(i[t]=n[t]?n[t]:e[t]);return i}),jLinq.util.isType(jLinq.type.method,t))for(f=0;f<u.length;f++)o=u[f],u[f]=t.apply(o,[o]);return u}}};n.library.addType(n.type.nothing,function(n){return n==null}),n.library.addType(n.type.array,function(n){return n instanceof Array}),n.library.addType(n.type.string,function(n){return n.substr&&n.toLowerCase}),n.library.addType(n.type.number,function(n){return n.toFixed&&n.toExponential}),n.library.addType(n.type.regex,function(n){return n instanceof RegExp}),n.library.addType(n.type.bool,function(n){return n==!0||n==!1}),n.library.addType(n.type.method,function(n){return n instanceof Function}),n.library.addType(n.type.datetime,function(n){return n instanceof Date}),n.library.extend([{name:"ignoreCase",type:n.command.action,method:function(){this.ignoreCase=!0}},{name:"reverse",type:n.command.action,method:function(){this.records.reverse()}},{name:"useCase",type:n.command.action,method:function(){this.ignoreCase=!1}},{name:"each",type:n.command.action,method:function(n){jLinq.util.each(this.records,function(t){n(t)})}},{name:"attach",type:n.command.action,method:function(n,t){this.when(t,{method:function(){jLinq.util.each(this.records,function(i){i[n]=t(i)})},other:function(){jLinq.util.each(this.records,function(i){i[n]=t})}})}},{name:"join",type:n.command.action,method:function(n,t,i,r){jLinq.util.each(this.records,function(u){u[t]=jLinq.from(n).equals(r,u[i]).select()})}},{name:"assign",type:n.command.action,method:function(n,t,i,r,u){jLinq.util.each(this.records,function(f){f[t]=jLinq.from(n).equals(r,f[i]).first(u)})}},{name:"sort",type:n.command.action,method:function(){var n=jLinq.util.toArray(arguments);this.records=jLinq.util.reorder(this.records,n,this.ignoreCase)}},{name:"equals",type:n.command.query,method:function(n){return jLinq.util.equals(this.value,n,this.ignoreCase)}},{name:"starts",type:n.command.query,method:function(n){return this.compare({array:function(){return jLinq.util.equals(this.value[0],n,this.ignoreCase)},other:function(){return jLinq.util.regexMatch("^"+jLinq.util.regexEscape(n),this.value,this.ignoreCase)}})}},{name:"ends",type:n.command.query,method:function(n){return this.compare({array:function(){return jLinq.util.equals(this.value[this.value.length-1],n,this.ignoreCase)},other:function(){return jLinq.util.regexMatch(jLinq.util.regexEscape(n)+"$",this.value,this.ignoreCase)}})}},{name:"contains",type:n.command.query,method:function(n){return this.compare({array:function(){var t=this.ignoreCase;return jLinq.util.until(this.value,function(i){return jLinq.util.equals(i,n,t)})},other:function(){return jLinq.util.regexMatch(jLinq.util.regexEscape(n),this.value,this.ignoreCase)}})}},{name:"match",type:n.command.query,method:function(n){return this.compare({array:function(){var t=this.ignoreCase;return jLinq.util.until(this.value,function(i){return jLinq.util.regexMatch(n,i,t)})},other:function(){return jLinq.util.regexMatch(n,this.value,this.ignoreCase)}})}},{name:"type",type:n.command.query,method:function(n){return jLinq.util.isType(n,this.value)}},{name:"greater",type:n.command.query,method:function(n){return this.compare({array:function(){return this.value.length>n},string:function(){return this.value.length>n},other:function(){return this.value>n}})}},{name:"greaterEquals",type:n.command.query,method:function(n){return this.compare({array:function(){return this.value.length>=n},string:function(){return this.value.length>=n},other:function(){return this.value>=n}})}},{name:"less",type:n.command.query,method:function(n){return this.compare({array:function(){return this.value.length<n},string:function(){return this.value.length<n},other:function(){return this.value<n}})}},{name:"lessEquals",type:n.command.query,method:function(n){return this.compare({array:function(){return this.value.length<=n},string:function(){return this.value.length<=n},other:function(){return this.value<=n}})}},{name:"between",type:n.command.query,method:function(n,t){return this.compare({array:function(){return this.value.length>n&&this.value.length<t},string:function(){return this.value.length>n&&this.value.length<t},other:function(){return this.value>n&&this.value<t}})}},{name:"betweenEquals",type:n.command.query,method:function(n,t){return this.compare({array:function(){return this.value.length>=n&&this.value.length<=t},string:function(){return this.value.length>=n&&this.value.length<=t},other:function(){return this.value>=n&&this.value<=t}})}},{name:"empty",type:n.command.query,method:function(){return this.compare({array:function(){return this.value.length==0},string:function(){return jLinq.util.trim(this.value).length==0},other:function(){return this.value==null}})}},{name:"is",type:n.command.query,method:function(){return this.compare({bool:function(){return this.value===!0},other:function(){return this.value!=null}})}},{name:"min",type:n.command.select,method:function(n){var t=jLinq.util.reorder(this.records,[n],this.ignoreCase);return jLinq.util.elementAt(t,0)}},{name:"max",type:n.command.select,method:function(n){var t=jLinq.util.reorder(this.records,[n],this.ignoreCase);return jLinq.util.elementAt(t,t.length-1)}},{name:"sum",type:n.command.select,method:function(n){var t;return jLinq.util.each(this.records,function(i){var r=jLinq.util.findValue(i,n);t=t==null?r:t+r}),t}},{name:"average",type:n.command.select,method:function(n){var t;return jLinq.util.each(this.records,function(i){var r=jLinq.util.findValue(i,n);t=t==null?r:t+r}),t/this.records.length}},{name:"skip",type:n.command.select,method:function(n,t){return this.records=this.when(t,{method:function(){return jLinq.util.skipTake(this.records,t,n,null)},object:function(){return jLinq.util.skipTake(this.records,t,n,null)},other:function(){return jLinq.util.skipTake(this.records,null,n,null)}}),this.query}},{name:"take",type:n.command.select,method:function(n,t){return this.when(t,{method:function(){return jLinq.util.skipTake(this.records,t,null,n)},object:function(){return jLinq.util.skipTake(this.records,t,null,n)},other:function(){return jLinq.util.skipTake(this.records,null,null,n)}})}},{name:"skipTake",type:n.command.select,method:function(n,t,i){return this.when(i,{method:function(){return jLinq.util.skipTake(this.records,i,n,t)},object:function(){return jLinq.util.skipTake(this.records,i,n,t)},other:function(){return jLinq.util.skipTake(this.records,null,n,t)}})}},{name:"select",type:n.command.select,method:function(n){return this.when(n,{method:function(){return jLinq.util.select(this.records,n)},object:function(){return jLinq.util.select(this.records,n)},other:function(){return this.records}})}},{name:"distinct",type:n.command.select,method:function(n){var t=jLinq.util.group(this.records,n,this.ignoreCase);return jLinq.util.grab(t,function(t){return jLinq.util.findValue(t[0],n)})}},{name:"group",type:n.command.select,method:function(n){return jLinq.util.group(this.records,n,this.ignoreCase)}},{name:"define",type:n.command.select,method:function(n){var t=this.when(n,{method:function(){return jLinq.util.select(this.records,n)},object:function(){return jLinq.util.select(this.records,n)},other:function(){return this.records}});return jLinq.from(t)}},{name:"any",type:n.command.select,method:function(){return this.records.length>0}},{name:"none",type:n.command.select,method:function(){return this.records.length==0}},{name:"all",type:n.command.select,method:function(){return this.removed.length==0}},{name:"first",type:n.command.select,method:function(n){var t=jLinq.util.elementAt(this.records,0);return t==null?n:t}},{name:"last",type:n.command.select,method:function(n){var t=jLinq.util.elementAt(this.records,this.records.length-1);return t==null?n:t}},{name:"at",type:n.command.select,method:function(n,t){var i=jLinq.util.elementAt(this.records,n);return i==null?t:i}},{name:"count",type:n.command.select,method:function(){return this.records.length}},{name:"removed",type:n.command.select,method:function(n){return this.when(n,{method:function(){return jLinq.util.select(this.removed,n)},object:function(){return jLinq.util.select(this.removed,n)},other:function(){return this.removed}})}},{name:"where",type:n.command.select,method:function(n){var r=this,i=[],t;return jLinq.util.each(this.records,function(t){n.apply(r,[t])===!0&&i.push(t)}),t=jLinq.from(i),this.ignoreCase||t.useCase(),t}}]),jLinq={alwaysClone:!1,ignoreCase:!0,command:n.command,type:n.type,extend:function(){n.library.extend.apply(null,arguments)},query:function(n,t){return library.framework.query(n,t)},from:function(t){return n.library.query(t,{clone:!1})},getCommands:function(){return n.util.grab(n.library.commands,function(t){return{name:t.name,typeId:t.type,type:t.type==n.command.select?"select":t.type==n.command.query?"query":t.type==n.command.action?"action":"unknown"}})},util:{trim:n.util.trim,findValue:n.util.findValue,elementAt:n.util.elementAt,regexEscape:n.util.regexEscape,regexMatch:n.util.regexMatch,equals:n.util.equals,group:n.util.group,reorder:n.util.reorder,when:n.util.when,toArray:n.util.toArray,each:n.util.each,grab:n.util.grab,until:n.util.until,isType:n.util.isType,getType:n.util.getType,apply:n.util.apply,select:n.util.select,skipTake:n.util.skipTake}},jlinq=jLinq,jl=jLinq})();
//@ sourceMappingURL=jlinq.min.js.map